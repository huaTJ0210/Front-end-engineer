<!DOCTYPE html>
<html>
  <head>
    <title>交强险信息查询</title> 
	<meta http-equiv="pragma" content="no-cache">
	<meta http-equiv="cache-control" content="no-cache">
	<meta http-equiv="expires" content="0">    
	<meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
	<meta http-equiv="description" content="This is my page">
	<meta charset="UTF-8">
	<meta name="viewport" content="initial-scale=1, maximum-scale=3, minimum-scale=1, user-scalable=no">
	<link rel="stylesheet" href="../static_resources/css/base.css"/>
    <script src="../static_resources/js/jquery-1.11.1.min.js"></script>
    <script src="../static_resources/js/script.js"></script>

  </head>
	<body>
		<!-- 		<img id='bannerLInk' src="../static_resources/images/eleBanner.jpg" class="bigBanner"/> -->
		<img id='bannerLInk' src="../static_resources/images/eleBanner.jpg" class="bigBanner"/>
		<div class="inquirybox" data-type="1">
			<div class="typebox">
				<span>查询类型</span>
				<p class="inquiry" id="type">按车辆查询</p>
				<span class="down_btn inquiry"></span>
			</div>
			
			<div class="car">
				<span>车牌号</span>
				<p>
					<i class="diqu" id="diqu1">京</i>
					<input type="text" placeholder="请输入车牌号" id="carNum" maxlength="7"/></p>
			</div>
			<div class="policy none">
				<span>保单号</span>
				<p><input type="text" placeholder="请输入保单号" id="policyNum"/></p>
			</div>
			<div>
				<span>发动机号</span>
				<p><input type="text" placeholder="请输入发动机号" id="engineNo"/></p>
			</div>
		</div>
		<p class="lastbtn" id="lastbtn">查询</p>
		<!--     选择车牌号 -->
    <div class="blac blac1 none" id="listBox">
    <input type="hidden" id="carnobox">
        <div class="whitebox">
            <ul id="list">
            </ul>
        </div>
    </div>
    <!-- 选择查询方式 -->
    <div class="blac blac1 none" id="listBtn">
    	 <div class="whitebox">
    	 	<h5>选择查询类型</h5>
	    	<p class="lastbtn" id="carbtn">按车辆查询</p>
	    	<p class="lastbtn" id="policybtn">按保单号查询</p>
    	 </div>
    	
    </div>
    <!--提交弹窗-->
<div id="tanwin" class="tan" style="display:none;"></div> 
<!-- 图片验证码 -->
<div class="blackDiv none">
	   <div class="whiteBoxa">
			<img id="imgCode" src="" alt="" onclick="code();">
			<p>
				<span>验证码</span> <input type="text" id="imgCodeinput" name="captcha" placeholder="请输入验证码" maxlength="4">
			</p>
			<div class="btn_f">
				<button class="close" id="quxiao">取消</button>
				<button class="blue" id="chaxun">查询</button>
			</div>
		</div>
	</div>
	<!-- loading页 -->
<div class="blac none" id="load">
  <img src="../static_resources/images/loading1.gif" class="loadingimg"/>
</div> 
	<!-- 提交数据，跳转页面 -->
	<form method="post" id="form" style="display:none;">
		<input type="text" id="hid" name="edata"/>
	</form>
		<script type="text/javascript">
		var u = navigator.userAgent;
		var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Adr') > -1; //android??
		var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios??
		window.onerror = function(err) {
		    console.log('window.onerror: ' + err)
		};

		function setupWebViewJavascriptBridge(callback) {
		    if (window.WebViewJavascriptBridge) { return callback(WebViewJavascriptBridge); }
		    else {
		        document.addEventListener('WebViewJavascriptBridgeReady', function() {
		            callback(WebViewJavascriptBridge)
		        }, false)
		    }
		    if (window.WVJBCallbacks) { return window.WVJBCallbacks.push(callback); }
		    window.WVJBCallbacks = [callback];
		    var WVJBIframe = document.createElement('iframe');
		    WVJBIframe.style.display = 'none';
		    WVJBIframe.src = 'wvjbscheme://__BRIDGE_LOADED__';
		    document.documentElement.appendChild(WVJBIframe);
		    setTimeout(function() { document.documentElement.removeChild(WVJBIframe) }, 0)
		}
		var publicbridge;
		var userId='';
		$(document).ready(function(){
		
			     
			setupWebViewJavascriptBridge(function(bridge) {
		    	if(isAndroid){
		       		bridge.init(function(message, responseCallback) {
		            //log('JS got a message', message)
		            	var data = { 'Javascript Responds':'Wee!' }
		            //log('JS responding with', data)
		            	responseCallback(data)
		        	})
		  		  }
		    	 bridge.callHandler('isLogin', '',function(response){
			         console.log('js调用客户端方法回调传参'+response);
			         userId = response.userid;
			         historyNo();
			      });	
		    	
		    	  $("#banner").click(function(){	
		    		 
		    		  bridge.callHandler('isLogin', '',function(response){
		    	         console.log('js调用客户端方法回调传参'+response);
		    	         var lsLogin = response.isLogin;
		    	         var userid = response.userid;
		    	         var data = {
	                             "userid":userid,
	                             "adid":"jiaoqiangxiang"
	                         }
	                         data = JSON.stringify(data)
	                         $.ajax({
	                             url: ajaxUrl + '/v1/ads/adsCount.do',
	                             type: 'post',
	                             contentType: 'application/json;charset=utf-8',
	                             dataType: "json",
	                             data:data,
	                             success: function(data) {
	                                 if(data.rescode != 200) {
	                                 }else{
	                                	 
	                                	 window.location.href = 'https://ecentre.spdbccc.com.cn/creditcard/indexActivity.htm?data=P908705&itemcode=hzwc000008'		 
	                                	 //window.location.href = 'https://ecentre.spdbccc.com.cn/creditcard/indexActivity.htm?data=P1744173&itemcode=jnhrdz0048'
	                                	 //window.location.href = 'https://ecentre.spdbccc.com.cn/creditcard/indexActivity.htm?data=I2517990'
                               			 
	                                		 
	                                 }
	                             }
	                         });
					  	});
				   })
				})
					publicbridge = bridge;
		});
		var city=$('#diqu1');
		var btn=$('#listBtn');
		var type=$('#type');
		var box=$('.listBox');
		var qType=1;
		
		code();
		$('#carNum,#engineNo,#policyNum').blur(function(){
		    $(this).val($.trim($(this).val().toUpperCase()));
		});
		/*车牌号选择地区*/
			var ajaxUrl = "https://cms.zhongchebaolian.com/cmsforbjmobile/"; 
			 var nyt = ['京','津','沪','渝','冀','豫','云','辽','黑','湘','皖','鲁','新','苏','浙','赣','鄂','桂','甘','晋','蒙','陕','吉','闽','贵','粤','青','藏','川','宁','琼'];
			  for(var mmm=0;mmm<nyt.length;mmm++){
			      $('.whitebox ul').append('<li>'+nyt[mmm]+'</li>');
			  };
			   $('.blac1 li').click(function(){
			   	$('#listBox').addClass('none');
			      var t = $(this).text();
			      city.text(t);
			  });
			   city.click(function(){
			   	$('#listBox').removeClass('none');
			   });
			   /*点击类型查询，选择查询的类型,相应的按车辆查询或按保单查询的输入框出现*/
			   $('.inquiry').click(function(){
			   	btn.removeClass('none');
			   });
			   $('#listBtn .lastbtn').click(function(){
			   		btn.addClass('none');
			   		var id=this.id;
			   		if(id=='carbtn'){
			   			type.text('按车辆查询');
			   			$('.car').removeClass('none');
			   			$('.policy').addClass('none');
			   			qType=1;
			   		}else{
			   			type.text('按保单号查询');
			   			$('.policy').removeClass('none');
			   			$('.car').addClass('none');
			   			box.data('type','2');
			   			qType=2;
			   		}
			   		historyNo();
			   });
		
			   /*点击查询，验证用户输入信息*/
			    /*点击查询,跳转系统升级页面*/
// 			   $('#lastbtn').click(function(){
// 				   window.location.href = 'jiaoqiangxian.html'
// 			   })
			   /* 查询  */
			   $('#lastbtn').click(function(){
				   carTxt='',carNum='',policyNum='';
				   var testcar=/^[0-9a-zA-Z]{7}$/;//车牌号正则
			   		if(qType==1){
			   			carTxt=city.text();
						carNum=$.trim($('#carNum').val());
			   			if(!testcar.test(carNum)){
			   				tanwin('请输入正确的车牌号');
			   				return false;
			   			}
			   			
			   		}else{
			   			policyNum=$.trim($('#policyNum').val());
			   			if(policyNum.length>length<=0){
			   				tanwin('请输入正确的保单号');
			   				return false;
			   			}
			   		}
			   		if($.trim($('#engineNo').val()).length<=0){
			   			tanwin('请输入正确的发动机号');
			   			return false;
			   		}
			   		details();
			   		
			   });
			   /* 图片验证码 */
			   $("#quxiao").click(function() {
					$(".blackDiv").addClass("none");
					$("#imgCodeinput").val("");
					num=0;
				});
			   /* 点击图片，刷新验证码 */
			   $("#chaxun").click(
				function() {
					check();

				});
			   /* 用户查询记录 */
			   function historyNo(){
				   /* 
					type=1   车类型
					type=2  保单类型
					*/
					$('#load').removeClass('none');
					$.ajax({
						'url':getRootPath()+'/getEipCategory.do?userId='+userId+'&qType='+qType,
						'type':'get',
						'success':function(data){
							$('#load').addClass('none');
							if(data.rescode!=200){
								tanwin(data.resdes);
							}else{
								if(qType==1){
									var carNo=data.resdata.carNo;
									var carNumber = decodeURI(carNo);
									city.text(carNumber.substring(0,1));
									$('#carNum').val(carNumber.substring(1));
								}else if(qType==2){
									$('#policyNum').val(data.resdata.insuranceNo);
								}
								
								$('#engineNo').val(data.resdata.engineNo)
							}
						}
					});
			   }
			   /* 查询后，返回结果做判断 */
			   function results(data){
				   
				   if(data.rescode==201){
					   $('#load').addClass('none');
  						tanwin(data.resdes)
  					}else if(data.rescode==200){
  						if(data.res=='没有投保记录'){
  							$('#load').addClass('none');
  							tanwin('没有投保记录');
  						}else{
  							$('#hid').val(JSON.stringify(data));
  							$('#form').attr('action',getRootPath()+'/showEipDetail.do').submit();
  							$('#load').addClass('none');
  						}
  					}else{
  						$('#load').addClass('none');
  						tanwin('查询失败，请重试');
  					}
			   }

   /* 验证图片方法 */
   	function check(){
		var imgCode = $("#imgCodeinput").val();
		if (imgCode == "") {
			tanwin("请填写验证码");
			return false;
		}
		var json={
			"imgcode" : imgCode
		};
		$.ajax({
			'url':getRootPath()+"/checkCode.do", 
			'data':JSON.stringify(json), 
			'type':'post',
			'contentType': "application/json; charset=utf-8",  
			'success':function(data) {
			var jsonObj = eval("(" + data + ")");
			if (jsonObj.rescode == "200") {
				$("#imgCodeinput").val("");
				details();

			} else {
				tanwin("验证码不正确");
				$("#imgCodeinput").val("");
				code();
			};

		},
		'error':function(){
		}
		});
		
		
		
	}
			   function details(){
				   $(".blackDiv").addClass("none");
				   $('#load').removeClass('none');
				   if(qType==1){
			   			$.ajax({
			   				'url':getRootPath()+'/getEipDetail.do?userId='+userId+'&qType=1&carNo='+encodeURI(carTxt)+carNum+'&engineNo='+$('#engineNo').val()+'&insuranceNo=',
			   				//'url':getRootPath()+'/getEipDetail.do?userId=72528cd3f9ca44d6a1959cc48ebd2cd8&qType=1&carNo='+carTxt+carNum+'&engineNo='+$('#engineNo').val()+'&insuranceNo=',
			   				'type':'get',
			   				'success':function(data){
			   					results(data);
			   					//$('#load').addClass('none');
			   				}
			   			})
			   		}else{
			   			$.ajax({
			   				'url':getRootPath()+'/getEipDetail.do?userId='+userId+'&qType=2&carNo=&engineNo='+$('#engineNo').val()+'&insuranceNo='+policyNum,
			   				//'url':getRootPath()+'/getEipDetail.do?userId=72528cd3f9ca44d6a1959cc48ebd2cd8&qType=2&carNo=&engineNo='+$('#engineNo').val()+'&insuranceNo='+policyNum,
			   				//'url':getRootPath()+'/getEipDetail.do?userId=2548534f4b244675adf935367d10f771&qType=2&carNo=&engineNo=9B320812&insuranceNo=PDZA20161102T000000446',
			   				'type':'get',
			   				'success':function(data){
			   					results(data);
			   					//$('#load').addClass('none');
			   				}
			   			})
			   		}
			   }
			   /* 刷新图片 */
			   function code(){
				    
				    $("#imgCode").attr("src",getRootPath()+'/imgCode.do?d='+Math.random());
				    
				  }
		</script>
<script src="https://s13.cnzz.com/z_stat.php?id=1273378808&web_id=1273378808" language="JavaScript"></script>

	</body>
</html>
